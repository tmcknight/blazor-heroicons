@inherits HeroiconBase

@if (_razorComponentType is not null)
{
    <DynamicComponent Type="_razorComponentType" Parameters="_parameters"></DynamicComponent>
}
else
{
    <Blazor.Heroicons.Outline.QuestionMarkCircleIcon @attributes="AdditionalAttributes" />
}

@code {
    /// <summary>
    /// The type of icon. Default: <see cref="HeroiconType.Outline"/>.
    /// </summary>
    [Parameter]
    public HeroiconType Type { get; set; } = HeroiconType.Outline;
    private HeroiconType _heroiconType = HeroiconType.Outline;
    private Type? _razorComponentType;
    private IReadOnlyDictionary<string, object>? _lastAttributes;
    private IDictionary<string, object>? _parameters;

    /// <summary>
    /// Optional seed for deterministic icon selection. Changing the seed picks a new icon.
    /// </summary>
    [Parameter]
    public int? Seed { get; set; }
    private int? _seed;

    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        if (_razorComponentType is null || _heroiconType != Type || _seed != Seed)
        {
            _heroiconType = Type;
            _seed = Seed;
            _razorComponentType = GetRandomIcon(Type, Seed);
        }

        if (_lastAttributes != AdditionalAttributes)
        {
            _lastAttributes = AdditionalAttributes;
            _parameters = AdditionalAttributes.ToDictionary(k => k.Key, v => v.Value);
        }
    }

    private static Type? GetRandomIcon(HeroiconType type, int? seed)
    {
        var componentTypes = HeroiconRegistry.GetAll(type);

        if (componentTypes.Length == 0)
            return null;

        var random = seed.HasValue ? new Random(seed.Value) : Random.Shared;
        return componentTypes[random.Next(componentTypes.Length)];
    }

}
